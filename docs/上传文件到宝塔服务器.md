# å¦‚ä½•ä¸Šä¼ æ–‡ä»¶åˆ°å®å¡”æœåŠ¡å™¨

## æ–¹æ³• 1ï¼šä½¿ç”¨å®å¡”æ–‡ä»¶ç®¡ç†å™¨ä¸Šä¼ ï¼ˆæ¨èæ–°æ‰‹ï¼‰

### æ­¥éª¤ï¼š

1. **ç™»å½•å®å¡”é¢æ¿**
   - æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® `http://æ‚¨çš„æœåŠ¡å™¨IP:8888`
   - è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ç™»å½•

2. **è¿›å…¥æ–‡ä»¶ç®¡ç†å™¨**
   - ç‚¹å‡»å·¦ä¾§èœå•çš„ **"æ–‡ä»¶"**
   - æˆ–ç›´æ¥ç‚¹å‡» **"æ–‡ä»¶ç®¡ç†å™¨"**

3. **å¯¼èˆªåˆ°ç›®æ ‡ç›®å½•**
   - åœ¨å·¦ä¾§ç›®å½•æ ‘ä¸­ï¼Œä¾æ¬¡å±•å¼€ï¼š
     - `/www`
     - `wwwroot`
     - `pychatcat.cloud`
     - `python-learning-assistant`
     - `backend`
   - æˆ–è€…ç›´æ¥åœ¨é¡¶éƒ¨è·¯å¾„æ è¾“å…¥ï¼š
     ```
     /www/wwwroot/pychatcat.cloud/python-learning-assistant/backend
     ```

4. **ä¸Šä¼ æ–‡ä»¶**
   - ç‚¹å‡»é¡¶éƒ¨å·¥å…·æ çš„ **"ä¸Šä¼ "** æŒ‰é’®
   - åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ï¼Œç‚¹å‡» **"é€‰æ‹©æ–‡ä»¶"**
   - é€‰æ‹©æœ¬åœ°ç”µè„‘ä¸Šçš„æ–‡ä»¶ï¼ˆå¦‚ `diagnose_cloud_connection.py`ï¼‰
   - ç‚¹å‡» **"å¼€å§‹ä¸Šä¼ "**
   - ç­‰å¾…ä¸Šä¼ å®Œæˆ

5. **éªŒè¯æ–‡ä»¶**
   - ä¸Šä¼ å®Œæˆåï¼Œåœ¨æ–‡ä»¶åˆ—è¡¨ä¸­åº”è¯¥èƒ½çœ‹åˆ°æ–°ä¸Šä¼ çš„æ–‡ä»¶
   - ç¡®è®¤æ–‡ä»¶åå’Œå¤§å°æ­£ç¡®

---

## æ–¹æ³• 2ï¼šç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºæ–‡ä»¶ï¼ˆæœ€å¿«ï¼‰

### ä½¿ç”¨ `cat` å‘½ä»¤åˆ›å»ºæ–‡ä»¶

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# 1. è¿›å…¥ç›®æ ‡ç›®å½•
cd /www/wwwroot/pychatcat.cloud/python-learning-assistant/backend

# 2. åˆ›å»ºè¯Šæ–­è„šæœ¬æ–‡ä»¶
cat > diagnose_cloud_connection.py << 'EOF'
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
è¯Šæ–­äº‘ç«¯è¿æ¥é—®é¢˜
åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œæ£€æŸ¥äº‘ç«¯ä¸ŠæŠ¥æ˜¯å¦æ­£å¸¸å·¥ä½œ
"""

import requests
import json
from datetime import datetime

BACKEND_URL = "https://pychatcat.cloud"

print("=" * 60)
print("ğŸ” äº‘ç«¯è¿æ¥è¯Šæ–­å·¥å…·")
print("=" * 60)
print(f"åç«¯åœ°å€: {BACKEND_URL}\n")

# 1. æµ‹è¯•å¥åº·æ£€æŸ¥
print("1ï¸âƒ£ æµ‹è¯•å¥åº·æ£€æŸ¥æ¥å£...")
try:
    response = requests.get(f"{BACKEND_URL}/api/health", timeout=5)
    if response.status_code == 200:
        data = response.json()
        print(f"   âœ… å¥åº·æ£€æŸ¥æˆåŠŸ: {data}")
    else:
        print(f"   âŒ å¥åº·æ£€æŸ¥å¤±è´¥: HTTP {response.status_code}")
        print(f"   å“åº”: {response.text}")
except Exception as e:
    print(f"   âŒ è¿æ¥å¤±è´¥: {e}")
    print(f"   ğŸ’¡ å¯èƒ½åŸå› : ç½‘ç»œä¸é€šã€é˜²ç«å¢™é˜»æ­¢ã€åŸŸåè§£æå¤±è´¥")

print()

# 2. æµ‹è¯•åˆ›å»ºä¼šè¯
print("2ï¸âƒ£ æµ‹è¯•åˆ›å»ºä¼šè¯æ¥å£...")
try:
    payload = {
        "user_id": "test_user_diagnose",
        "device_label": "è¯Šæ–­å·¥å…·"
    }
    response = requests.post(
        f"{BACKEND_URL}/api/sessions",
        json=payload,
        timeout=5,
        headers={"Content-Type": "application/json"}
    )
    if response.status_code == 201:
        data = response.json()
        session_id = data.get("session_id")
        print(f"   âœ… ä¼šè¯åˆ›å»ºæˆåŠŸ: {session_id}")
        
        # 3. æµ‹è¯•ä¸ŠæŠ¥è¡Œä¸º
        print("\n3ï¸âƒ£ æµ‹è¯•ä¸ŠæŠ¥å­¦ä¹ è¡Œä¸º...")
        behavior_payload = {
            "behavior_code": "CP",
            "duration": 10.5,
            "additional_data": {"test": True}
        }
        behavior_response = requests.post(
            f"{BACKEND_URL}/api/sessions/{session_id}/behaviors",
            json=behavior_payload,
            timeout=5,
            headers={"Content-Type": "application/json"}
        )
        if behavior_response.status_code == 201:
            print(f"   âœ… è¡Œä¸ºä¸ŠæŠ¥æˆåŠŸ")
        else:
            print(f"   âŒ è¡Œä¸ºä¸ŠæŠ¥å¤±è´¥: HTTP {behavior_response.status_code}")
            print(f"   å“åº”: {behavior_response.text}")
    else:
        print(f"   âŒ ä¼šè¯åˆ›å»ºå¤±è´¥: HTTP {response.status_code}")
        print(f"   å“åº”: {response.text}")
except Exception as e:
    print(f"   âŒ è¯·æ±‚å¤±è´¥: {e}")

print()

# 4. æ£€æŸ¥æ•°æ®åº“
print("4ï¸âƒ£ æ£€æŸ¥æ•°æ®åº“æœ€æ–°è®°å½•...")
try:
    import sqlite3
    import os
    
    db_path = os.path.join(os.path.dirname(__file__), 'data', 'learning_analytics.db')
    if os.path.exists(db_path):
        conn = sqlite3.connect(db_path)
        cursor = conn.cursor()
        
        # æŸ¥çœ‹æœ€è¿‘çš„ä¼šè¯
        cursor.execute("""
            SELECT session_id, user_id, start_time, total_activities
            FROM user_sessions
            ORDER BY start_time DESC
            LIMIT 5
        """)
        sessions = cursor.fetchall()
        
        if sessions:
            print(f"   âœ… æ•°æ®åº“ä¸­æœ‰ {len(sessions)} æ¡æœ€è¿‘ä¼šè¯:")
            for sess in sessions:
                print(f"      - {sess[1]} ({sess[2]}) - {sess[3]} ä¸ªæ´»åŠ¨")
        else:
            print(f"   âš ï¸ æ•°æ®åº“ä¸­æ²¡æœ‰ä¼šè¯è®°å½•")
        
        # æŸ¥çœ‹æœ€è¿‘çš„è¡Œä¸º
        cursor.execute("""
            SELECT COUNT(*) FROM learning_behaviors
            WHERE timestamp >= datetime('now', '-7 days')
        """)
        recent_count = cursor.fetchone()[0]
        print(f"   ğŸ“Š æœ€è¿‘7å¤©çš„è¡Œä¸ºè®°å½•æ•°: {recent_count}")
        
        conn.close()
    else:
        print(f"   âš ï¸ æ•°æ®åº“æ–‡ä»¶ä¸å­˜åœ¨: {db_path}")
except Exception as e:
    print(f"   âŒ æ£€æŸ¥æ•°æ®åº“å¤±è´¥: {e}")

print()
print("=" * 60)
print("ğŸ’¡ è¯Šæ–­å»ºè®®:")
print("=" * 60)
print("1. å¦‚æœå¥åº·æ£€æŸ¥å¤±è´¥ï¼Œæ£€æŸ¥:")
print("   - æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ")
print("   - Nginx é…ç½®æ˜¯å¦æ­£ç¡®")
print("   - é˜²ç«å¢™æ˜¯å¦å…è®¸ HTTPS è¿æ¥")
print()
print("2. å¦‚æœä¼šè¯åˆ›å»ºå¤±è´¥ï¼Œæ£€æŸ¥:")
print("   - Flask åç«¯æ˜¯å¦æ­£å¸¸è¿è¡Œ")
print("   - æ•°æ®åº“æ–‡ä»¶æƒé™æ˜¯å¦æ­£ç¡®")
print()
print("3. å¦‚æœæ¡Œé¢åº”ç”¨æ— æ³•è¿æ¥ï¼Œæ£€æŸ¥:")
print("   - æ¡Œé¢åº”ç”¨çš„ BACKEND_URL é…ç½®")
print("   - æ¡Œé¢åº”ç”¨å¯åŠ¨æ—¶æ˜¯å¦æ˜¾ç¤º 'ğŸŒ äº‘ç«¯è¡Œä¸ºä¸ŠæŠ¥å·²å¯ç”¨'")
print("   - æ¡Œé¢åº”ç”¨çš„ç½‘ç»œç¯å¢ƒï¼ˆæ ¡å›­ç½‘å¯èƒ½é˜»æ­¢ HTTPSï¼‰")
print("   - æŸ¥çœ‹æ¡Œé¢åº”ç”¨çš„ logs/analytics_*.log æ–‡ä»¶")
print("=" * 60)
EOF

# 3. è®¾ç½®æ‰§è¡Œæƒé™
chmod +x diagnose_cloud_connection.py

# 4. éªŒè¯æ–‡ä»¶å·²åˆ›å»º
ls -lh diagnose_cloud_connection.py

# 5. è¿è¡Œè¯Šæ–­è„šæœ¬
python3 diagnose_cloud_connection.py
```

---

## æ–¹æ³• 3ï¼šä½¿ç”¨ Git æ¨é€ï¼ˆå¦‚æœé¡¹ç›®åœ¨ Git ä»“åº“ä¸­ï¼‰

å¦‚æœæ‚¨ä½¿ç”¨ Git ç®¡ç†é¡¹ç›®ï¼š

```bash
# åœ¨æœ¬åœ°ç”µè„‘
git add backend/diagnose_cloud_connection.py
git commit -m "æ·»åŠ è¯Šæ–­è„šæœ¬"
git push

# åœ¨æœåŠ¡å™¨ä¸Š
cd /www/wwwroot/pychatcat.cloud/python-learning-assistant
git pull
```

---

## æ–¹æ³• 4ï¼šä½¿ç”¨ SCP å‘½ä»¤ï¼ˆä»æœ¬åœ°ç”µè„‘ä¸Šä¼ ï¼‰

åœ¨æœ¬åœ°ç”µè„‘çš„ç»ˆç«¯æ‰§è¡Œï¼š

```bash
# Windows PowerShell
scp backend/diagnose_cloud_connection.py root@æ‚¨çš„æœåŠ¡å™¨IP:/www/wwwroot/pychatcat.cloud/python-learning-assistant/backend/

# æˆ–ä½¿ç”¨å®Œæ•´è·¯å¾„
scp E:\cursor_web\backend\diagnose_cloud_connection.py root@43.134.110.238:/www/wwwroot/pychatcat.cloud/python-learning-assistant/backend/
```

---

## æ¨èæ–¹æ³•

- **æ–°æ‰‹ç”¨æˆ·**ï¼šä½¿ç”¨æ–¹æ³• 1ï¼ˆå®å¡”æ–‡ä»¶ç®¡ç†å™¨ï¼‰- æœ€ç®€å•ç›´è§‚
- **ç†Ÿæ‚‰å‘½ä»¤è¡Œçš„ç”¨æˆ·**ï¼šä½¿ç”¨æ–¹æ³• 2ï¼ˆç›´æ¥åœ¨æœåŠ¡å™¨åˆ›å»ºï¼‰- æœ€å¿«
- **ä½¿ç”¨ Git çš„ç”¨æˆ·**ï¼šä½¿ç”¨æ–¹æ³• 3ï¼ˆGit æ¨é€ï¼‰- æœ€è§„èŒƒ

---

## éªŒè¯æ–‡ä»¶å·²ä¸Šä¼ 

ä¸Šä¼ å®Œæˆåï¼Œåœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/pychatcat.cloud/python-learning-assistant/backend
ls -lh *.py
```

åº”è¯¥èƒ½çœ‹åˆ°ï¼š
- `diagnose_cloud_connection.py`
- `view_data.py`
- `app.py`

ç„¶åè¿è¡Œï¼š

```bash
python3 diagnose_cloud_connection.py
```




